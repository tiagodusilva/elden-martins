-- title: Elden Martins
-- author: Scrum Monkeys
-- desc:   The adventures and puzzles of a young Joe Martins
-- script: lua

--------SFX--------
--Tocar nestas notas
--44 - D#4 -- partir pedra
--50 - B#3 -- entaglement
--51 - B#3 -- second entanglemtn
--56 - A#3 -- cant break block
--58 - F#7 -- fogo
--60 - C#5 -- gelo


--------------- CONSTANTS ----------------
btiles = {
		empty = 0,
  map_player = 34,
  goal = 33, 
  wall = 32,
  rock_min = 1,
  rock_max = 15,
  ice = 90,
  fire = {
  	initial = 144, 			-- starting sprite
   nr_sprites = 3,		 -- number of sprites
   rate = 10,								-- total animation frames 
   cur_frame = 0					-- current animation frame
  }
}

animations = {}

ftiles = {
	player = {
		260, --up
		261, --down
		259, --left (flipped)
	 259  --right
	},
	entangle = 274,
	pick = 258
}

screenw = 240
screenh = 136

----------------- MAIN --------------------

t=0
cur_lvl = 4

-- pick is a stack
lvls = {
	{ent = 0, pick = {}},
	{ent = 0, pick = {2, 2, 8, 6}},
	{ent = 0, pick = {4, 3, 2, 1, 5, 1}},
	{ent = 8, pick = {1, 1, 1, 1, 1, 1}},
	{ent = 2, pick = {4, 3, 6, 2}},
	{ent = 0, pick = {1, 1, 4}},
	{ent = 2, pick = {1, 1}},
	{ent = 0, pick = {}}	
}

p = {
	ent = 0,
	pick = {},
 x = 0,
 y = 0,
	dirx = 0,
 diry = 0,
 look = 0, -- up < down < left < right
 entang = false,
 curr_entang = nil,
 ice_skating = false,
 cur_pick = 1,
 dead = false
}

entangs = {}

function TIC()
				
				if (t == 0) then
					load_level(cur_lvl)
				end
				
				input();
				update();
				render();
    
    t=t+1
end

function input()

 -- reset
	if btnp(7) then
		load_level(cur_lvl)
		return
	end
	
	--if p.dead then
	--	return
	--end
	
	if p.ice_skating == true then return end

	p.diry = 0
 p.dirx = 0
 p.entang = false
 p.break_block = false
 
	if btnp(5) then p.entang = true end
	if btnp(4) then p.break_block = true end

	if btnp(0, 10, 8) then
		p.diry = -1
		p.look = 0 
		return --up
	end
	if btnp(1, 10, 8) then
		p.diry = 1 
		p.look = 1
		return --down
	end
	if btnp(2, 10, 8) then
		p.dirx = -1
		p.look = 2
		return --left
	end
	if btnp(3, 10, 8) then
		p.dirx = 1
		p.look = 3
		return --right
	end
end

------------------ UPDATE --------------

function update()

	local newx = p.x + p.dirx
	local newy = p.y + p.diry
	
	if newx ~= p.x or newy ~= p.y then
		
		local tile = mget(newx, newy)
		
		if not handleFireTile(tile, newx, newy) then
			tile = btiles.empty
		end
		
		if (handleIceTile(tile, newx, newy)
			or handleGoalTile(tile, newx, newy)
			or handleEmptyTile(tile, newx, newy)
		) then end
		
	else 
			-- No movement
			local lookTile = getLookTile()
			
			tile = mget(lookTile[1], lookTile[2])
			
		if (handleEntang(tile, lookTile[1], lookTile[2])
			or handleRockTile(tile, lookTile[1], lookTile[2])
		)
			 then end 
	end
end

function handleIceTile(tile, newx, newy)
	
	if tile == btiles.ice then
		p.ice_skating = true
		sfx(60, "C#5", -1, 3)
		return false
	end
	
	if p.ice_skating == false then
		return false
	end

	if (tile == btiles.empty 
					or tile == btiles.wall
					or (tile >= btiles.rock_min 
					and tile <= btiles.rock_max)
	 )
	then
		p.ice_skating = false
		return false
	end
	
	return true
end

function handleFireTile(tile, newx, newy)
			
 for k, v in pairs(animations) do
 	if isTablesEqual(k, {newx, newy}) then
  	if p.cur_pick <= #p.pick then
				p.cur_pick = p.cur_pick + 1
			end
			animations[k] = nil
			-- table.remove(animations, index)
			mset(newx, newy, btiles.empty)
			sfx(58, "F#7", -1, 3)
   return false
  end
	end
	return true
end

function handleRockTile(tile, newx, newy)
	if not p.break_block then return false end
	
	if tile >= btiles.rock_min and tile <= btiles.rock_max then

			if p.cur_pick <= #p.pick then
				local cur_pick = p.pick[p.cur_pick]
				
				if cur_pick >= tile then
				 -- table.remove(p.pick, 1)
					p.cur_pick = p.cur_pick + 1
					mset(newx, newy, btiles.empty)
					
					if p.curr_entang ~= nil and isTablesEqual(p.curr_entang, {newx, newy}) then
						p.curr_entang = nil
					end
					
					local broke = false
					
					for i = 1, #entangs do
						for j = 1, #(entangs[i]) do
							if isTablesEqual(entangs[i][j], {newx, newy}) then
								-- remove all tiles in the entanglement that contains this tile
								for k = 1, #entangs[i] do
									mset(entangs[i][k][1], entangs[i][k][2], btiles.empty)			
								end
								
								table.remove(entangs, i)
								
								broke = true
								break	
							end
						end
						if broke then break end
					end
					
				else
					sfx(56, "A#3", -1, 3)
				end
			else
					sfx(56, "A#3", -1, 3)
			end
			
			sfx(44, "D#4", -1, 3)
			return true
		end
		
		return false
end

function handleGoalTile(tile, newx, newy)
	if tile == btiles.goal then
		p.x = newx
		p.y = newy
		
		mset(newx, newy, btiles.empty)
		
		load_level(cur_lvl + 1)
		
		return true
	end
			
	return false
end

function handleEmptyTile(tile, newx, newy)

	if tile == btiles.empty or tile == btiles.ice then
		p.x = newx
		p.y = newy
		
		return true
	end
			
	return false
end


function handleEntang(tile, x, y)
  if not (p.entang == true and p.ent > 0) then return false end
		if tile >= btiles.rock_min and tile <= btiles.rock_max then
			if p.curr_entang == nil then
				p.curr_entang = {x,y}
				sfx(50, "B#3", -1, 3)
			else 
				if	not isTablesEqual(p.curr_entang, {x,y}) then
					if not isInEntang({x,y}) then
						entangs[#entangs + 1] = {p.curr_entang,{x,y}}
						p.curr_entang = nil
						p.ent = p.ent - 1
						sfx(51, "B#3", -1, 3)
					end
				else
					p.curr_entang = nil
				end
			end
		end
end

function isInEntang(tileCoords)
	for i = 1, #entangs do
		for j = 1, #entangs[i] do
			if isTablesEqual(entangs[i][j], tileCoords) then
				return true
			end
		end
	end
	return false
end

function getLookTile()
	if p.look == 0 then return {p.x, p.y - 1} end
	if p.look == 1 then return {p.x, p.y + 1} end
	if p.look == 2 then return {p.x - 1, p.y} end
	if p.look == 3 then return {p.x + 1, p.y} end
end

--------------- RENDERING ---------------------
 
function render()

 map(0, 0, 30, 17)
 drawAnimations()
	drawPlayer()
	drawEntangs()
	hud()

end

function drawAnimations()

	for k, v in pairs(animations) do
		if v ~= nil then
		 spr(v.initial + (v.cur_frame / v.rate) % v.nr_sprites, k[1] * 8, k[2] * 8, 0)
		 v.cur_frame = v.cur_frame + 1
		end
	end
end

function drawPlayer()
	 
	local flip = 0
	if p.look == 2 then flip = 1 end
	spr(ftiles.player[p.look + 1], p.x * 8, p.y * 8, 0, 1, flip)
end

function drawEntangs()
	if p.curr_entang ~= nil then
		rectb(p.curr_entang[1] * 8, p.curr_entang[2] * 8, 8, 8, 1)
	end
	
	for i = 1, #entangs do
		rectb(entangs[i][1][1] * 8, entangs[i][1][2] * 8, 8, 8, (i + 1)%15)
		rectb(entangs[i][2][1] * 8, entangs[i][2][2] * 8, 8, 8, (i + 1)%15)
	end
end
 
function hud()

	--rect(0, 0, screenw, 10, 6)
	local w = print("Level " .. tostring(cur_lvl), -10, -10)
	rect(0, 0, w + 2, 10, 6) 
	print("Level " .. tostring(cur_lvl), 2, 2)

	
	spr(ftiles.pick, 80, 1, 0)

	local used_pick_values = ""
	local unused_pick_values = ""	
		
	for k, v in pairs(p.pick) do
		if k < p.cur_pick then
			used_pick_values = used_pick_values .. v .. " "
		elseif k == p.cur_pick then
			unused_pick_values = " [" ..  v  .. "] "
		else
			unused_pick_values = unused_pick_values .. v .. " "
		end
	end
	local w = print(used_pick_values, 90 + 1, 2, 9)
 print(unused_pick_values, 90 + w, 2)
	
	-- TODO: replace text with icon
	local ePos = reversePrint("x" .. p.ent, 1, 2)
	spr(ftiles.entangle, screenw - ePos - 10, 1, 0)
	
end


----------- LEVELS ----------------

function load_level(lvl)
	
	cur_lvl = lvl

	-- Load lvl properties
	local lvl_data = lvls[lvl]
	p.ent = lvl_data.ent
	p.pick = table.copy(lvl_data.pick)
	p.curr_entang = nil
	p.cur_pick = 1
	p.dead = false
	entangs = {}
	animations = {}
	

	-- Copy map
	local mapx = 30 * (lvl % 8)
	local mapy = 17 * (lvl // 8)
	
	for i = mapx, mapx + 30 do
		for j = mapy, mapy + 17 do
			tile = mget(i, j)
			worldx = i % 30
			worldy = j % 17
			mset(worldx, worldy, tile)
			
			if tile == btiles.map_player then
				p.x = worldx
				p.y = worldy
				
				mset(worldx, worldy, btiles.empty)
			end
			
			if tile == btiles.fire.initial then
				animations[{worldx, worldy}] = table.copy(btiles.fire)
				mset(worldx, worldy, btiles.empty)
			end
			
		end
	end

end










---------------- UTILS ---------------
function table.copy(t)
  local t2 = {}
  for k,v in pairs(t) do
    t2[k] = v
  end
  return t2
end


-- !!!Does not work with nested lists!!!
function isTablesEqual(list1, list2)
	if #list1 ~= #list2 then return false end
	
	for i = 1, #list1 do
		if list1[i] ~= list2[i] then
			return false
		end	
	end
	
	return true
end



function reversePrint(text, x, y, color, fixed, scale, smallfont) 
 color = color or 15
 fixed = fixed or false
 scale = scale or 1
 smallfont = smallfont or false
 local width = print(text, 0, -30, color, fixed, scale, smallfont)
	return print(text, (240 - width - x), y, color, fixed, scale, smallfont)
end
-- <TILES>
-- 001:eeeeeeeeea8889aee89989aeeaaa89aeeaaa89aeeaaa89aee888889eeeeeeeee
-- 002:eeeeeeeeea88889ee89aa89eeaaa889eeaa889aee88aaaaee888889eeeeeeeee
-- 003:eeeeeeeeea8888aee8aaa89eeaa889aeeaaaa89ee8aaa89eea8889aeeeeeeeee
-- 004:eeeeeeeeea88aaaeea8aaaaee89a8aaee888889eeaaa89aeeaa889aeeeeeeeee
-- 005:eeeeeeeee888889ee889aaaee8889aaeeaaa889eeaaaa88ee88889aeeeeeeeee
-- 006:eeeeeeeeea8889aee889aaaee88889aee8aaa89ee8aaaa8ee888888eeeeeeeee
-- 007:eeeeeeeee888888ee888888eeaaa889eeaaa88aeeaa889aeeaa889aeeeeeeeee
-- 008:eeeeeeeeee8889aee8aaa89eea8888aee8aaa89ee8aaa89eea8889aeeeeeeeee
-- 009:eeeeeeeee888889ee8aaa89ee888889eeaaaa89eeaaa89aeeaa89aaeeeeeeeee
-- 010:eeeeeeeeea8888aeea89a8aeea89a8aee888889ee8aaa89ee8aaa89eeeeeeeee
-- 011:eeeeeeeee88889aee8aa89aee88889aee8aaa89ee8aaa89ee888889eeeeeeeee
-- 012:eeeeeeeeea88889ee89aaaaee89aaaaee89aaaaee89aaaaeea88889eeeeeeeee
-- 013:eeeeeeeee88889aee89aa89ee89aa89ee89aa89ee89aa89ee88889aeeeeeeeee
-- 014:eeeeeeeee888889ee89aaaaee8889aaee88889aee89aaaaee888889eeeeeeeee
-- 015:eeeeeeeee888889ee89aaaaee89aaaaee8889aaee89aaaaee89aaaaeeeeeeeee
-- 032:eecddccceeccdecdcccceedddcccccccddcddeccccccdeedcdcceeccecddcccc
-- 033:00000000444444440777bbb007a77ab000a77a0000aa7a0000777b0000000000
-- 034:07555570055ab55005abaa5005baaa5005555550055775500550055005500550
-- 035:d0000dc0cc000c0000000000cdc00ddcdd0000dd0000000c00c0dc000d00dcc0
-- 048:07555570055ab55005abaa5005baaa5005555550055775500550055005500550
-- 049:0055550000aa550000aa55000055550000555500007755000077550000775500
-- 060:0000000000000000000000700000bbcc077bcc00007000000000000000000000
-- 061:0000000000077770000b7b7000777770077777700777b7c00bbbbc0000000000
-- 062:0005000660560000000000500600005605000000000605500000060006000000
-- 063:0600006000000000006500000005000560000056550000000000500000060000
-- 076:00077777000b7bb7000b7b7700777777077777770777b7cc0bbbbbc000000000
-- 077:00000770000007b7000077cc00077b000077c00077bc0000777000000bb00000
-- 090:0000000000008000000000000800008000000000000800000800008000000000
-- 128:dddddddddcccccccdcccccccdcccccccdcccccccdcccccccdcccccccdddddddd
-- 129:ddddddddccccccccccccccccccccccccccccccccccccccccccccccccdddddddd
-- 136:eecddccce222222dc22ce22dd22cc22cd22dd22cc22cd22dc222222cecddcccc
-- 137:eecddcccee2222cdc22222dddccc22ccddcd22cccccc22edc222222cecddcccc
-- 138:eecddcccee22222dc22cc22ddcccc22cddc222ccc22cdeedc222222cecddcccc
-- 139:eecddcccee2222cdc2cce22ddcc222ccddcdd22cc2ccd22dcd2222ccecddcccc
-- 140:eecddccce666666dc66ce66dd66cc66cd66dd66cc66cd66dc666666cecddcccc
-- 141:eecddcccee6666cdc66666dddccc66ccddcd66cccccc66edc666666cecddcccc
-- 142:eecddcccee66666dc66cc66ddcccc66cddc666ccc66cdeedc666666cecddcccc
-- 143:eecddcccee6666cdc6cce66ddcc666ccddcdd66cc6ccd66dcd6666ccecddcccc
-- 144:0000000000111000011100001122100012321100124311101124211001111100
-- 145:0001100000001000001100000111110011231110112331101124211001111110
-- 146:0000000000001100000001100000121000112310011223100112441001111110
-- 147:0055660006555660556666555556655606666660000cc0000dedddc00dedddc0
-- 148:04bbb0000bc4c0000bbcc000044c990000aaa9900009a00000099aa000000099
-- 152:eecddcccee22decdcc2ceeddd22c2cccd222222ccccc2eedcdc22eccecddcccc
-- 153:eecddccce222222dc22ceeddd222ccccddcd22ccccccd22dc22222ccecddcccc
-- 154:eecddcccee222ecdc22ceeddd2222cccd2cdd22cc2ccde2dc222222cecddcccc
-- 155:eecddccce222222dc222222ddccc22ccddcd22ccccc22eedcdc22eccecddcccc
-- 156:eecddcccee66decdcc6ceeddd66c6cccd666666ccccc6eedcdc66eccecddcccc
-- 157:eecddccce666666dc66ceeddd666ccccddcd66ccccccd66dc66666ccecddcccc
-- 158:eecddcccee666ecdc66ceeddd6666cccd6cdd66cc6ccde6dc666666cecddcccc
-- 159:eecddccce666666dc666666ddccc66ccddcd66ccccc66eedcdc66eccecddcccc
-- 168:eecddcccee2222cdc2ccee2ddc2222ccd2cdde2cc2ccde2dcd2222ccecddcccc
-- 169:eecddccce222222dc2ccee2dd222222cddcdd22ccccc22edcdc22eccecddcccc
-- 170:eecddcccee2222cdcc2ce2dddc2cc2ccd222222cc2ccde2dc2ccee2cecddcccc
-- 171:eecddccce2222ecdc2cce2ddd22222ccd2cdde2cc2ccde2dc22222ccecddcccc
-- 172:eecddcccee6666cdc6ccee6ddc6666ccd6cdde6cc6ccde6dcd6666ccecddcccc
-- 173:eecddccce666666dc6ccee6dd666666cddcdd66ccccc66edcdc66eccecddcccc
-- 174:eecddcccee6666cdcc6ce6dddc6cc6ccd666666cc6ccde6dc6ccee6cecddcccc
-- 175:eecddccce6666ecdc6cce6ddd66666ccd6cdde6cc6ccde6dc66666ccecddcccc
-- 184:eecddcccee22222dc2cceeddd2ccccccd2cddeccc2ccdeedcd22222cecddcccc
-- 185:eecddccce22222cdc2ccee2dd2cccc2cd2cdde2cc2ccde2dc22222ccecddcccc
-- 186:eecddccce222222dc2cceeddd222ccccd2222eccc2ccdeedc222222cecddcccc
-- 187:eecddccce222222dc22ceeddd22cccccd2222eccc22cdeedc22ceeccecddcccc
-- 188:eecddcccee66666dc6cceeddd6ccccccd6cddeccc6ccdeedcd66666cecddcccc
-- 189:eecddccce66666cdc6ccee6dd6cccc6cd6cdde6cc6ccde6dc66666ccecddcccc
-- 190:eecddccce666666dc6cceeddd666ccccd6666eccc6ccdeedc666666cecddcccc
-- 191:eecddccce666666dc66ceeddd66cccccd6666eccc66cdeedc66ceeccecddcccc
-- 200:cbbcccccdcdddbddcccccbbbdddcdddcbbbbccccdbdddcddcccccbbbdddcdddb
-- 201:ccccccccdcdddcddccccccccdddcdddcccccccccdcdddcddccccccccdddcdddc
-- 202:eeeeeeeeecccccceeddddddeecccccceeddddddeecccccceeddddddeeeeeeeee
-- 203:888888888aaaaaa8899999988aaaaaa8899999988aaaaaa88999999888888888
-- 204:eecddccce666667dc67ce67dd67cc67cd67dd67cc67cd67dc666667cecddcccc
-- 205:eecddcccee6667cdc67767dddccc67ccddcd67cccccc67edc666667cecddcccc
-- 206:eecddcccee66667dc67cc67ddccc667cddc667ccc66cdeedc666667cecddcccc
-- 207:eecddcccee6666cdc6cce67ddcc667ccddcdd67cc6ccd67dcd6667ccecddcccc
-- 208:0444ffdd000ff4fc00004f98000dc98800dcc0890dcc0009dcc00008dc000000
-- 216:0000000000c0c0000cd00000000000000eec0dc0ddcccddceeeddc0000000000
-- 217:ccc000ccd0eeecddcccccc00dddcdeecc00cccccdccddcddc000ccccddd0eedc
-- 218:00000000020000002220000023300000d4200000cd000000c000000000000000
-- 219:000000000000000000aaaa000faaaaf0afddddfaabccccbaabaaaabaabccccba
-- 220:eecddcccee66decdcc6ceeddd67c6cccd666667ccccc67edcdc667ccecddcccc
-- 221:eecddccce666667dc667eeddd6667cccddcd667cccccd66dc66667ccecddcccc
-- 222:eecddcccee6667cdc667eeddd66667ccd6cdd67cc6ccde6dc666666cecddcccc
-- 223:eecddccce666666dc666666ddccc667cddcd66ccccc667edcdc667ccecddcccc
-- 224:000fff4400f44444000008ff0000000900000000000000000000000d000000cd
-- 225:44ff0dddffff4ddcff44f8c0844ff8809fff8988ddf8988fddc988ffccc99fff
-- 236:eecddcccee66667dc6cce67ddc6666ccd6cdd67cc6ccd67dcd6667ccecddcccc
-- 237:eecddccce666667dc6cce67dd666667cddcdd67ccccc67edcdc67eccecddcccc
-- 238:eecddcccee6666cdcc67e6dddc67c6ccd666667cc6ccd67dc6cce67cecddcccc
-- 239:eecddccce66667cdc6cc67ddd66667ccd6cdd67cc6ccd67dc666667cecddcccc
-- 240:00000ddc0000ddcc000cdccc00ddccc0dddccc00dddcc000dccc0000cccc0000
-- 241:cc009ff8c00009f8000009890000008900000099000000900000000000000000
-- 242:eecddccce222221dc21ce21dd21cc21cd21dd21cc21cd21dc222221cecddcccc
-- 252:eecddcccee66667dc67ceeddd67cccccd67ddeccc67cdeedcd66667cecddcccc
-- 253:eecddccce66667cdc67ce67dd67cc67cd67dd67cc67cd67dc66667ccecddcccc
-- 254:eecddccce666667dc67ceeddd6667cccd66667ccc67cdeedc666667cecddcccc
-- 255:eecddccce666667dc67ceeddd67cccccd6667eccc67cdeedc67ceeccecddcccc
-- </TILES>

-- <SPRITES>
-- 000:0422000004444117057700113322267b3322270a322223000eedd0000e00d000
-- 001:042211170444461b0577076a0222233a0332220003322ddd03ee00000e000000
-- 002:0444ffdd000ff4fc00004f98000dc98800dcc0890dcc0009dcc00008dc000000
-- 003:00ee30000dea70000dd770000555550007555700077557000772170000201000
-- 004:00eee00000eee0000ddddd000555550007555700075557000722170000201000
-- 005:00e3e00000a7a0000d777d000555550007555700075557000722170000201000
-- 016:04220117044440113377067b3322270a322223000eedd0000e00d00000000000
-- 018:0000000000988700094948700794897007984970078494900078890000000000
-- 032:04444117046606113322277b3222230a3eed23000e0dd000e00d000000000000
-- 064:0443333001311310013333100023320000011000000110000033220004333330
-- 065:00000000444444440777bbb007a77ab000a77a0000aa7a0000777b0000000000
-- 066:000000000ffffff00fbbbbf00ffffff00fbbbbf00f0000f00ffffff000000000
-- </SPRITES>

-- <MAP>
-- 000:000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 003:000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 004:000000000000000000000000000000000000000000000000000000000000000000000000000002020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002009012900002000000000000000000000000000000000000000000000000000000000000000202020202020000000000000000000000000000000002009012900002000000000000000000000000000000000000000000000202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000
-- 005:000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000002000000000200000000000000000000000000000002020202020200000000000000000000000000000000000000000000000000000002000010000002000000000000000000000000000000000000000000000000000000000000000210101010020000000000000000000000000000000002000090000002000000000000000000000000000000000000000000000200000000000000000000000000020000000000000000000000000000000002020202020202020202020200000000000000
-- 006:000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000002000012000200000000000000000000000000000002000000000200000000020202000000000000000000000000000000000000000002000000000002000000000000000000000000000000000000000000000000000000000000000210101010020000000000000000000000000000000002000000000002000000000000000000000000000000000000000000000200000000000000000000000000020000000000000000000000000000020202a5a502a5a5a5a5a5a5a50200000000000000
-- 007:00000000000000000000000000000000000000000000000000000000000000000000000000020000000002a5a5a5a50200000000020000000000000000000000000000000200001200020000000002000002000000000000000000000000000000000000000200000000000200000000000000000000000000000000000000020000000000000000000000021010101002000000000000000000000000000000000200000000000200000000000000000000000000000000000000000000020000000000000000000000000002000000000000000000000000000002a5a5a5a5a5a5a5a5a5a5a5a50202020200000000
-- 008:00000000000000000000000000000000000000000000000000000000000000000000000000020000000002a5a5a5a50200000000020000000000000000000202020202020220000000020000000002020200000000000000000000000000000000000000000260020202500200000000000000000000000000000000000002000200000000000000000202021010101002000000000000000000000000000000000250020202600200000000000000000000000000000000000000000000020000000000000000000000000002000000000000000000000000000002a5a5a5a5a5a5a5a5a502a5a5a5a5a50200000000
-- 009:00000000000000000000000000000000000000000000000000000000000000000000000000020000000002a5a5a5a50200000000020000000000000000000200000010000080200000020000000002000002000000000000000000000000000000000000000210023902200200000000000000000000000000000000000002020200000000000000000200900000000002000000000000000000000000000000000220023902100200000000000000000000000000000000000000000000020000000000000000000000000002000000000000000000000000000202a5a5a5a5a5a5a5a5a5a5a5a50202a50200000000
-- 010:00000000000000000000000000000000000000000000000000000000000000000000000000020000000002a5a5a5a502000000000200000000000000000002002200020000000202020200000000020202000000000000000000000000000000000000000002200202023002000000000000000000000000000000000000020002000000000000000002129000000000020000000000000000000000000000000002300202024002000000000000000000000000000000000000000000000200000002020202020202404040020000000000000202020202020202a5a5a5a5a5a5a5a5a5a5a5a5a50202a50200000000
-- 011:0000000000000000000000000000000000000000000000000000000000000000000000000002002200000200000000000000000002000000000000000000020000002000000002000000000000000000000000000000000000000000000000000000000000020000000000020000000000000000000000000000000000000000000000000000000000020090000000000200000000000000000000000000000000020000000000020000000000000000000000000000000000000000000002000000000009090900100000000200000000000002a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a50200000000
-- 012:0000000000000000000000000000000000000000000000000000000000000000000000000002000000000200000000000000000002000000000000000000020202020202020202000000000000000000000000000000000000000000000000000000000000020000220000020000000000000000000000000000000000000000000000000000000000020202000022000200000000000000000000000000000000020000220000020000000000000000000000000000000000000000000002002200000009090900100012000200000000000002a5020202020202a5a5a510a5a5a5a5a5a5a5a5a50202020200000000
-- 013:0000000000000000000000000000000000000000000000000000000000000000000000000000020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000020000000000000000000000000000000000000000000000000000000000000002000000000200000000000000000000000000000000020000000000020000000000000000000000000000000000000000000002000000000009090900100000000200000000000002a5020202020202020202020202100022000202020200000000000000
-- 014:0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020202020202020000000000000000000000000000000000000000000000000000000000000002020202020200000000000000000000000000000000020202020202020000000000000000000000000000000000000000000002020202020202020202020202020200000000000002a5009000900012000200000002020202020200000000000000000000
-- 015:000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000202020202020202020200000000000000000000000000000000000000
-- 021:000000000000020202020202020202020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 022:0000000000000200000000000909091009090902a5a5a502000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 023:0000000000000200000000000009090909090090a5a5a502000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 024:0000000000000200000000000000000000300002a5a5a502020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 025:0000000000000200000000000002090909090902a5a5a502000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 026:0000000000000222000000000000000209090002a5a5a5a5001202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 027:000000000000020000000000000209094000006002a55002000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 028:0000000000000200000000000009090009090920a5a5a502020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 029:0000000000000200000000000909090009091002a5a5a502000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 030:000000000000020202020202020202020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </MAP>

-- <WAVES>
-- 000:00000000ffffffff00000000ffffffff
-- 001:0123456789abcdeffedcba9876543210
-- 002:0123456789abcdef0123456789abcdef
-- </WAVES>

-- <SFX>
-- 000:000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000304000000000
-- 044:2f004f005f006f007f009f00af00af00bf00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00309000000000
-- 050:2c004c305c306c307c30fc302c0b4c3b5c3bfc3bfc3bfc3bfc00fc00fc00fc00fc00fc00fc00fc00fc00fc00fc00fc00fc00fc00fc00fc00fc00fc00a85000000000
-- 051:2c004c305c306c307c30fc302c0b4c3b5c3bfc3bfc3bfc3b2c074c375c376c377c37fc37fc00fc00fc00fc00fc00fc00fc00fc00fc00fc00fc00fc00a8b000000000
-- 056:05000500050005000500f500f500f5000500050005000500050005000500f500f500f500f500f500f500f500f500f500f500f500f500f500f500f500204000000000
-- 058:5f006f006f007f009f00af00bf00cf00cf00df00ef00ef00ef00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00605000000000
-- 060:74205460249004c004c004c004c024c034b044a05490646084509430a420a400b400c400f400f400f400f400f400f400f400f400f400f400f400f400405000000000
-- </SFX>

-- <PALETTE>
-- 000:000014b31909c55510e4c719e9dbc065a65f448244c5a4868b9c9d6475862f1559745765430e276b273b862639c5b5b5
-- </PALETTE>

